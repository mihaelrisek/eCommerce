<h1>Narudzba</h1>

<% if (order) {%>


  <form id="cancel_order_form" action="/order/cancel-order/<%=order._id %>" method="POST">
    <table class="order">
      <tbody>
          <tr> <td>ID narudžbe</td><td><%= order._id %></td></tr>
          <tr> <td>Ime</td><td><%= order.user.first_name %></td></tr>
          <tr> <td>Prezime</td><td><%= order.user.last_name %></td></tr>
          <tr> <td>Email</td><td><%= order.user.email %></td></tr>
          <tr> <td>Phone</td><td><%= order.user.phone %></td></tr>
          <tr> <td>Datum narudžbe</td><td><%= order.order_date.toLocaleString() %></td></tr>
          <tr> <td>Ukupni iznos</td><td>$<%= order.total_amount.toFixed(2) %></td></tr>
          <tr> <td>Stanje narudžbe</td><td><%= order.status %></td></tr>
          <tr> <td>Naćin plačanja</td><td><%= order.payment_method == 'cod'? 'Pouzeće' : 'Kartično plaćanje' %></td></tr>
  
          <tr> <td>Država</td><td><%= order.address.region %></td></tr>
          <tr> <td>Ulica</td><td><%= order.address.street %></td></tr>
          <tr> <td>Mjesto</td><td><%= order.address.city %></td></tr>
          <tr> <td>Poštanski broj</td><td><%= order.address.zip_code %></td></tr>
          
          <% order.cart_items.forEach((item, index) => { %>
            <tr><td><h2>Proizvod <%= index+1  %> </h2></td></tr>
            <tr><td> Naziv proizvoda </td><td><%= item.product.name %></td></tr>
            <% if (item.product.discount && item.product.discount.active) { %>
              <tr><td>Cijena jednog proizvoda uz popust </td><td>$<%= (item.product.price - (item.product.price * (item.product.discount.active ? item.product.discount.percentage / 100 : 0))).toFixed(2) %></td></tr>
              <tr><td>Popust</td><td><%= item.product.discount.percentage %> %</td></tr>
            <% } else { %>
              <tr><td> Cijena jednog proizvoda </td><td>$<%= item.product.price %></td></tr>
            <% } %>
            <tr><td> Kolicina</td><td> <%= item.quantity %></td></tr>
            <tr><td> Materijal</td><td> <%= item.product.material %></td></tr>
            <tr><td> Kategorija</td><td> <%= item.product.category %></td></tr>
            <% if (item.sizes){ %>
              <tr><td> Velicina</td><td> <%= item.sizes %></td></tr>
              <tr><td> <strong>Status</strong></td><td> <%= order.status %></td></tr>
            <% } %>
          <% }) %>
              
            </tbody>
    </table>
      <h3>Status narudzbe</h3>
      <div class="order_select_status">

        <% switch (order.status) { 
          case "U tijeku": %>
          <div class="order_select">
              <i></i>
              <span>
                <svg width="24" height="24" viewBox="0 0 256 256"><path fill="currentColor" d="M128 40a96 96 0 1 0 96 96a96.11 96.11 0 0 0-96-96m0 176a80 80 0 1 1 80-80a80.09 80.09 0 0 1-80 80m45.66-125.66a8 8 0 0 1 0 11.32l-40 40a8 8 0 0 1-11.32-11.32l40-40a8 8 0 0 1 11.32 0M96 16a8 8 0 0 1 8-8h48a8 8 0 0 1 0 16h-48a8 8 0 0 1-8-8"/></svg>
                U tijeku
              </span>
            </div>
            <% break;
          case "Na putu": %>
          <div class="order_select">
              <i></i>
              <span>
                <svg width="24" height="24" viewBox="0 0 32 32"><path fill="currentColor" d="M0 6v2h19v15h-6.156c-.446-1.719-1.992-3-3.844-3c-1.852 0-3.398 1.281-3.844 3H4v-5H2v7h3.156c.446 1.719 1.992 3 3.844 3c1.852 0 3.398-1.281 3.844-3h8.312c.446 1.719 1.992 3 3.844 3c1.852 0 3.398-1.281 3.844-3H32v-8.156l-.063-.157l-2-6L29.72 10H21V6zm1 4v2h9v-2zm20 2h7.281L30 17.125V23h-1.156c-.446-1.719-1.992-3-3.844-3c-1.852 0-3.398 1.281-3.844 3H21zM2 14v2h6v-2zm7 8c1.117 0 2 .883 2 2s-.883 2-2 2s-2-.883-2-2s.883-2 2-2m16 0c1.117 0 2 .883 2 2s-.883 2-2 2s-2-.883-2-2s.883-2 2-2"/></svg>
                Na putu
              </span>
            </div>
            <% break;
         case "Dostavljeno": %>
         <div class="order_select">
              <i></i>
              <span>
                <svg width="24" height="24" viewBox="0 0 32 32"><path fill="currentColor" d="M5 5v22h22V5zm2 2h18v18H7zm14.281 4.281L14 18.562l-3.281-3.28l-1.438 1.437l4 4l.719.687l.719-.687l8-8z"/></svg>
                Dostavljeno
              </span>
            </div>
            <% break;
        } %>

    
    
      </div>

      <% if (order.status == 'U tijeku') {%>
        <button data-order-id="<%=order._id %>"  type="submit" >Prekini narudžbu</button>
      <%}%>
   
  </form>


<% } %>



